/*
 * jQuery jCombo Plugin v3.0
 * Carlos De Oliveira
 * cardeol@gmail.com
 * Latest Release: Dic 2013
 */
;(function(e,t,n,r){function u(t,n){this.options=e.extend({},o,n);this.element=t;this.init()}var i="jCombo",s="3.0",o={url:null,parent:null,first_optval:"__jc__",input_param:null,data:null,selected_value:null,onLoad:null,onChange:null,initial_text:"-- Please Select --",method:"GET",dataType:"jsonp"};u.prototype={_addParameter:function(e,t){if(e==null||t==null)return false;this.options.data=e+"="+t;return true},_getJson:function(t,n){var r=this;var i=r.options.orig_data!=null?r.options.orig_data:"";i+=r.options.data!=null?r.options.data:"";e.ajax({url:t,data:i,type:r.options.dataType,dataType:"jsonp",method:r.options.method,success:n})},_onLoadCall:function(){if(this.options.onLoad!=null){var e=this.options.onLoad;this.options.onLoad=null;e()}},_getData:function(e,n){var r=this;t.__jcombo_data_cache=typeof t.__jcombo_data_cache==="undefined"?{}:t.__jcombo_data_cache;var i=JSON.stringify(e+r.options.orig_data+"&"+r.options.data);if(!t.__jcombo_data_cache[i]||true){r._getJson(e,function(e){t.__jcombo_data_cache[i]=e;n(e)})}else setTimeout(function(){n(t.__jcombo_data_cache[i])},0)},_renderOption:function(e,t,n){var r="";if(n==true)r=' selected="selected"';return'<option value="'+e+'"'+r+">"+t+"</option>"},_firstOption:function(){if(this.initial_text=="")return"";return this._renderOption(this.options.first_optval,this.options.initial_text,false)},_renderSelect:function(e,t){var n=[];if(typeof t=="undefined")t=this.options.first_optval;n.push(this._firstOption());for(var r in e){var i=e[r];n.push(this._renderOption(i.id,i.value,i.id==t))}return n.join("")},_bindSelect:function(t,n){var r=this;var i=this.options.url;n=n==null?t:n;if(this.options.input_param==null)i+=t==null?"":t;else this._addParameter(this.options.input_param,n);var s=e(r.element).attr("id");if(n==this.options.first_optval||t==this.options.first_optval){e(this.element).html(this._firstOption());e(this.element).attr("disabled","disabled");e(r.element).trigger("change");r._onLoadCall()}else{this._getData(i,function(i){e(r.element).html(r._renderSelect(i,n));r._onLoadCall();if(n!=null||t==null){e(r.element).trigger("change");if(r.options.onChange!=null)r.options.onChange(n)}if(i.length>0)e(r.element).removeAttr("disabled")})}},init:function(){var t=this;this.options.orig_data=this.options.data;if(this.options.parent!=null){e(this.options.parent).each(function(n,r){var i=e(r).val();e(r).bind("change",function(){t._bindSelect(e(r).val(),t.options.selected_value)})})}else this._bindSelect(null,t.options.selected_value)}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new u(this,t))}})}})(jQuery,window,document);